{
  "type": "excalidraw",
  "version": 2,
  "source": "co-code-manager",
  "elements": [
    {
      "id": "title",
      "type": "text",
      "x": 400,
      "y": 20,
      "width": 400,
      "height": 45,
      "text": "Agent Runtime Flow",
      "fontSize": 36,
      "fontFamily": 2,
      "textAlign": "center",
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },
    {
      "id": "subtitle",
      "type": "text",
      "x": 350,
      "y": 70,
      "width": 500,
      "height": 25,
      "text": "From CLI start to message response",
      "fontSize": 16,
      "fontFamily": 2,
      "textAlign": "center",
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },

    {
      "id": "phase1-box",
      "type": "rectangle",
      "x": 50,
      "y": 120,
      "width": 300,
      "height": 180,
      "strokeColor": "#339af0",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase1-title",
      "type": "text",
      "x": 70,
      "y": 130,
      "width": 260,
      "height": 25,
      "text": "1. STARTUP",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#339af0",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase1-file",
      "type": "text",
      "x": 70,
      "y": 155,
      "width": 260,
      "height": 18,
      "text": "cli.ts:78-164",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase1-content",
      "type": "text",
      "x": 70,
      "y": 180,
      "width": 260,
      "height": 100,
      "text": "agent start --id xyz\n\n1. Check API key (OPENAI/ANTHROPIC)\n2. Create LLM config\n3. createAgent({ agentId, llm })\n4. agent.initialize()",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "phase2-box",
      "type": "rectangle",
      "x": 400,
      "y": 120,
      "width": 350,
      "height": 180,
      "strokeColor": "#40c057",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase2-title",
      "type": "text",
      "x": 420,
      "y": 130,
      "width": 310,
      "height": 25,
      "text": "2. INITIALIZATION",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase2-file",
      "type": "text",
      "x": 420,
      "y": 155,
      "width": 310,
      "height": 18,
      "text": "core/agent.ts:114-186",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase2-content",
      "type": "text",
      "x": 420,
      "y": 180,
      "width": 310,
      "height": 100,
      "text": "Load Identity (Ed25519 keypair)\n       |\nLoad Self Memory (values, style)\n       |\nInit: MemoryStore, ModelSelector,\n      SleepManager, Consolidator\n       |\nselectAtWake() -> Choose initial model",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "phase3-box",
      "type": "rectangle",
      "x": 800,
      "y": 120,
      "width": 300,
      "height": 180,
      "strokeColor": "#be4bdb",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase3-title",
      "type": "text",
      "x": 820,
      "y": 130,
      "width": 260,
      "height": 25,
      "text": "3. MODEL SELECTION",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#be4bdb",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase3-file",
      "type": "text",
      "x": 820,
      "y": 155,
      "width": 260,
      "height": 18,
      "text": "core/llm/selector.ts:37-95",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase3-content",
      "type": "text",
      "x": 820,
      "y": 180,
      "width": 260,
      "height": 100,
      "text": "Score = Nature + Nurture + Entropy\n\nNature (60%): Birth traits\n  - curiosity, patience, empathy\n\nNurture (30%): Current state\n  - budget, mood, fatigue\n\nEntropy (10%): SHA256 hash\n  - Prevents prediction",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "arrow1-2",
      "type": "arrow",
      "x": 350,
      "y": 210,
      "width": 50,
      "height": 0,
      "strokeColor": "#495057",
      "strokeWidth": 2,
      "points": [[0, 0], [50, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "arrow2-3",
      "type": "arrow",
      "x": 750,
      "y": 210,
      "width": 50,
      "height": 0,
      "strokeColor": "#495057",
      "strokeWidth": 2,
      "points": [[0, 0], [50, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },

    {
      "id": "waiting-label",
      "type": "text",
      "x": 500,
      "y": 320,
      "width": 200,
      "height": 25,
      "text": "Agent is ONLINE, waiting...",
      "fontSize": 14,
      "fontFamily": 2,
      "textAlign": "center",
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },

    {
      "id": "arrow-down",
      "type": "arrow",
      "x": 600,
      "y": 345,
      "width": 0,
      "height": 30,
      "strokeColor": "#495057",
      "strokeWidth": 2,
      "points": [[0, 0], [0, 30]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },

    {
      "id": "phase4-box",
      "type": "rectangle",
      "x": 50,
      "y": 390,
      "width": 350,
      "height": 160,
      "strokeColor": "#fd7e14",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase4-title",
      "type": "text",
      "x": 70,
      "y": 400,
      "width": 310,
      "height": 25,
      "text": "4. MESSAGE ARRIVES",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#fd7e14",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase4-file",
      "type": "text",
      "x": 70,
      "y": 425,
      "width": 310,
      "height": 18,
      "text": "core/agent.ts:282-378 (handleMessage)",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase4-content",
      "type": "text",
      "x": 70,
      "y": 450,
      "width": 310,
      "height": 80,
      "text": "Input: { channelId, senderId, content }\n\n1. Load context: getSelf(), getBudget()\n2. Build system prompt from identity\n3. Call runAgenticLoop()",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "phase5-box",
      "type": "rectangle",
      "x": 450,
      "y": 390,
      "width": 650,
      "height": 320,
      "strokeColor": "#f03e3e",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase5-title",
      "type": "text",
      "x": 470,
      "y": 400,
      "width": 610,
      "height": 25,
      "text": "5. AGENTIC LOOP (The Core)",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#f03e3e",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase5-file",
      "type": "text",
      "x": 470,
      "y": 425,
      "width": 610,
      "height": 18,
      "text": "core/agentic/loop.ts:72-229",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },

    {
      "id": "negotiate-box",
      "type": "rectangle",
      "x": 470,
      "y": 450,
      "width": 200,
      "height": 70,
      "strokeColor": "#495057",
      "backgroundColor": "#2d1a0a",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "negotiate-text",
      "type": "text",
      "x": 480,
      "y": 460,
      "width": 180,
      "height": 50,
      "text": "NEGOTIATE\n- Check fatigue\n- Check budget",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#fd7e14",
      "backgroundColor": "transparent"
    },

    {
      "id": "think-box",
      "type": "rectangle",
      "x": 700,
      "y": 450,
      "width": 120,
      "height": 70,
      "strokeColor": "#495057",
      "backgroundColor": "#162419",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "think-text",
      "type": "text",
      "x": 715,
      "y": 465,
      "width": 90,
      "height": 40,
      "text": "THINK\nllm.complete()",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "center",
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },

    {
      "id": "act-box",
      "type": "rectangle",
      "x": 850,
      "y": 450,
      "width": 120,
      "height": 70,
      "strokeColor": "#495057",
      "backgroundColor": "#162419",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "act-text",
      "type": "text",
      "x": 865,
      "y": 465,
      "width": 90,
      "height": 40,
      "text": "ACT\ntool_calls?",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "center",
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },

    {
      "id": "observe-box",
      "type": "rectangle",
      "x": 1000,
      "y": 450,
      "width": 80,
      "height": 70,
      "strokeColor": "#495057",
      "backgroundColor": "#162419",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "observe-text",
      "type": "text",
      "x": 1010,
      "y": 470,
      "width": 60,
      "height": 30,
      "text": "OBSERVE\nresult",
      "fontSize": 11,
      "fontFamily": 2,
      "textAlign": "center",
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },

    {
      "id": "arrow-neg-think",
      "type": "arrow",
      "x": 670,
      "y": 485,
      "width": 30,
      "height": 0,
      "strokeColor": "#40c057",
      "strokeWidth": 2,
      "points": [[0, 0], [30, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "arrow-think-act",
      "type": "arrow",
      "x": 820,
      "y": 485,
      "width": 30,
      "height": 0,
      "strokeColor": "#40c057",
      "strokeWidth": 2,
      "points": [[0, 0], [30, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "arrow-act-observe",
      "type": "arrow",
      "x": 970,
      "y": 485,
      "width": 30,
      "height": 0,
      "strokeColor": "#40c057",
      "strokeWidth": 2,
      "points": [[0, 0], [30, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },

    {
      "id": "loop-arrow",
      "type": "arrow",
      "x": 1040,
      "y": 520,
      "width": 280,
      "height": 40,
      "strokeColor": "#868e96",
      "strokeWidth": 1,
      "points": [[0, 0], [0, 40], [-280, 40], [-280, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "loop-label",
      "type": "text",
      "x": 820,
      "y": 545,
      "width": 150,
      "height": 18,
      "text": "Loop until submit_response",
      "fontSize": 10,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },

    {
      "id": "submit-box",
      "type": "rectangle",
      "x": 470,
      "y": 580,
      "width": 200,
      "height": 50,
      "strokeColor": "#40c057",
      "backgroundColor": "#162419",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "submit-text",
      "type": "text",
      "x": 490,
      "y": 592,
      "width": 160,
      "height": 26,
      "text": "submit_response(text)\n-> DONE, return text",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },

    {
      "id": "frustration-box",
      "type": "rectangle",
      "x": 700,
      "y": 580,
      "width": 200,
      "height": 50,
      "strokeColor": "#f03e3e",
      "backgroundColor": "#2d1a0a",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "frustration-text",
      "type": "text",
      "x": 720,
      "y": 590,
      "width": 160,
      "height": 30,
      "text": "No tool calls?\nfrustration++ -> stress",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#f03e3e",
      "backgroundColor": "transparent"
    },

    {
      "id": "exit-box",
      "type": "rectangle",
      "x": 930,
      "y": 580,
      "width": 150,
      "height": 50,
      "strokeColor": "#fd7e14",
      "backgroundColor": "#2d1a0a",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 2 }
    },
    {
      "id": "exit-text",
      "type": "text",
      "x": 945,
      "y": 590,
      "width": 120,
      "height": 30,
      "text": "Exit conditions:\nfatigued | frustrated",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#fd7e14",
      "backgroundColor": "transparent"
    },

    {
      "id": "statuses-text",
      "type": "text",
      "x": 470,
      "y": 650,
      "width": 610,
      "height": 50,
      "text": "Return Status: completed | fatigued | budget_exhausted | frustrated | rest\nEach status triggers different post-loop behavior",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },

    {
      "id": "arrow-4-5",
      "type": "arrow",
      "x": 400,
      "y": 470,
      "width": 50,
      "height": 0,
      "strokeColor": "#495057",
      "strokeWidth": 2,
      "points": [[0, 0], [50, 0]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },

    {
      "id": "phase6-box",
      "type": "rectangle",
      "x": 50,
      "y": 580,
      "width": 350,
      "height": 140,
      "strokeColor": "#339af0",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase6-title",
      "type": "text",
      "x": 70,
      "y": 590,
      "width": 310,
      "height": 25,
      "text": "6. POST-LOOP",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#339af0",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase6-file",
      "type": "text",
      "x": 70,
      "y": 615,
      "width": 310,
      "height": 18,
      "text": "core/agent.ts:339-373",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase6-content",
      "type": "text",
      "x": 70,
      "y": 640,
      "width": 310,
      "height": 70,
      "text": "1. Update costs: budget.spentToday\n2. Consume energy: tokens/10\n3. Check warnings (70%, 90%)\n4. If fatigued/frustrated -> sleep()\n5. Save vitals, return response",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "phase7-box",
      "type": "rectangle",
      "x": 50,
      "y": 750,
      "width": 500,
      "height": 150,
      "strokeColor": "#be4bdb",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "phase7-title",
      "type": "text",
      "x": 70,
      "y": 760,
      "width": 460,
      "height": 25,
      "text": "7. SLEEP CYCLE",
      "fontSize": 18,
      "fontFamily": 2,
      "strokeColor": "#be4bdb",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase7-file",
      "type": "text",
      "x": 70,
      "y": 785,
      "width": 460,
      "height": 18,
      "text": "core/sleep.ts:88-117",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "phase7-content",
      "type": "text",
      "x": 70,
      "y": 810,
      "width": 460,
      "height": 80,
      "text": "1. DREAM: consolidator.consolidate() - summarize, merge memories\n2. RECHARGE: waking.current = waking.capacity (full energy)\n3. REDUCE STRESS: stress = stress * 0.5 (halved)\n4. RESET MOOD: mood = (mood + 0.75) / 2 (drift to optimistic)\n\nAfter sleep: Full energy, reduced stress, NEW model selection!",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "arrow-6-7",
      "type": "arrow",
      "x": 200,
      "y": 720,
      "width": 0,
      "height": 30,
      "strokeColor": "#be4bdb",
      "strokeWidth": 2,
      "points": [[0, 0], [0, 30]],
      "startArrowhead": null,
      "endArrowhead": "arrow"
    },
    {
      "id": "sleep-trigger-label",
      "type": "text",
      "x": 210,
      "y": 728,
      "width": 150,
      "height": 18,
      "text": "if fatigued/frustrated",
      "fontSize": 10,
      "fontFamily": 2,
      "strokeColor": "#be4bdb",
      "backgroundColor": "transparent"
    },

    {
      "id": "unique-box",
      "type": "rectangle",
      "x": 600,
      "y": 750,
      "width": 500,
      "height": 150,
      "strokeColor": "#40c057",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "unique-title",
      "type": "text",
      "x": 620,
      "y": 760,
      "width": 460,
      "height": 25,
      "text": "WHAT MAKES THIS AGENT UNIQUE",
      "fontSize": 16,
      "fontFamily": 2,
      "strokeColor": "#40c057",
      "backgroundColor": "transparent"
    },
    {
      "id": "unique-content",
      "type": "text",
      "x": 620,
      "y": 790,
      "width": 460,
      "height": 100,
      "text": "1. Model selection at WAKE, not per-task\n   (Like human waking up, picks mindset based on how it feels)\n\n2. Fatigue/Sleep cycle with memory consolidation\n\n3. Frustration -> Stress -> Forced rest\n\n4. Birth traits (Nature 60%) influence model preference permanently\n\n5. Entropy (10%) prevents manipulation",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "gaps-box",
      "type": "rectangle",
      "x": 50,
      "y": 930,
      "width": 1050,
      "height": 100,
      "strokeColor": "#f03e3e",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 2,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "gaps-title",
      "type": "text",
      "x": 70,
      "y": 940,
      "width": 200,
      "height": 25,
      "text": "IMPLEMENTATION GAPS",
      "fontSize": 16,
      "fontFamily": 2,
      "strokeColor": "#f03e3e",
      "backgroundColor": "transparent"
    },
    {
      "id": "gaps-content",
      "type": "text",
      "x": 70,
      "y": 970,
      "width": 1010,
      "height": 50,
      "text": "1. tools: [] hardcoded (agent.ts:329) - No MCP tools reach the loop\n2. Birth traits generated at runtime (agent.ts:149) - Not loaded from soul/birth.yaml\n3. No CLI runner for interactive testing - Can't easily chat with agent\n4. Memory path is global (~/.co-code/memory.json) - Not per-agent memories/ directory",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#e9ecef",
      "backgroundColor": "transparent"
    },

    {
      "id": "legend-box",
      "type": "rectangle",
      "x": 50,
      "y": 1050,
      "width": 400,
      "height": 60,
      "strokeColor": "#495057",
      "backgroundColor": "#1a1a2e",
      "fillStyle": "solid",
      "strokeWidth": 1,
      "roughness": 0,
      "roundness": { "type": 3 }
    },
    {
      "id": "legend-title",
      "type": "text",
      "x": 70,
      "y": 1060,
      "width": 80,
      "height": 18,
      "text": "FILE REFS:",
      "fontSize": 12,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },
    {
      "id": "legend-content",
      "type": "text",
      "x": 70,
      "y": 1080,
      "width": 360,
      "height": 25,
      "text": "All paths relative to: packages/agent-runtime/src/",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    },

    {
      "id": "date-label",
      "type": "text",
      "x": 950,
      "y": 1080,
      "width": 150,
      "height": 18,
      "text": "Created: 2026-01-30",
      "fontSize": 11,
      "fontFamily": 2,
      "strokeColor": "#868e96",
      "backgroundColor": "transparent"
    }
  ],
  "appState": {
    "viewBackgroundColor": "#0d1117",
    "gridSize": null
  },
  "files": {}
}
